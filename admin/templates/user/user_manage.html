{% extends "base.html" %}
{% block cssblock %}
   <link rel="stylesheet" type="text/css" href="/static/assets/plugins/select2/select2_metro.css" />
   <link rel="stylesheet" href="/static/assets/plugins/data-tables/DT_bootstrap.css" />
    <link href="/static/assets/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet" type="text/css"/>
   <link href="/static/assets/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css"/>
   <style>
    .pagination > ul > li {
			  display: inline;
			}
			.pagination > ul > li > a,
			.pagination > ul > li > span {
			  position: relative;
			  float: left;
			  padding: 6px 12px;
			  margin-left: -1px;
			  line-height: 1.42857143;
			  color: #337ab7;
			  text-decoration: none;
			  background-color: #fff;
			  border: 1px solid #ddd;
			}
			.pagination > ul > li:first-child > a,
			.pagination > ul > li:first-child > span {
			  margin-left: 0;
			  border-top-left-radius: 4px;
			  border-bottom-left-radius: 4px;
			}
			.pagination > ul > li:last-child > a,
			.pagination > ul > li:last-child > span {
			  border-top-right-radius: 4px;
			  border-bottom-right-radius: 4px;
			}
			.pagination > ul > li > a:hover,
			.pagination > ul > li > span:hover,
			.pagination > ul > li > a:focus,
			.pagination > ul > li > span:focus {
			  z-index: 3;
			  color: #23527c;
			  background-color: #eee;
			  border-color: #ddd;
			}
			.pagination > ul > .active > a,
			.pagination > ul > .active > span,
			.pagination > ul > .active > a:hover,
			.pagination > ul > .active > span:hover,
			.pagination > ul > .active > a:focus,
			.pagination > ul > .active > span:focus {
			  z-index: 2;
			  color: #fff;
			  cursor: default;
			  background-color: #337ab7;
			  border-color: #337ab7;
			}
			.pagination > ul > .disabled > span,
			.pagination > ul > .disabled > span:hover,
			.pagination > ul > .disabled > span:focus,
			.pagination > ul > .disabled > a,
			.pagination > ul > .disabled > a:hover,
			.pagination > ul > .disabled > a:focus {
			  color: #777;
			  cursor: not-allowed;
			  background-color: #fff;
			  border-color: #ddd;
			}
   </style>
{% endblock %}
{% block content %}

    <div class="row">
            <div class="col-md-12">
               <!-- BEGIN PAGE TITLE & BREADCRUMB-->
               <h3 class="page-title">
                  注册用户管理 <small>statistics and more</small>
               </h3>
               <ul class="page-breadcrumb breadcrumb">
                  <li>
                     <i class="icon-home"></i>
                     <a href="/index">Home</a>
                     <i class="icon-angle-right"></i>
                  </li>
                  <li><a href="#">用户管理</a></li>
               </ul>
               <!-- END PAGE TITLE & BREADCRUMB-->
            </div>
    </div>

    <div class="row">
            <div class="col-md-12">
               <div class="portlet box blue">
                  <div class="portlet-title">
                     <div class="caption"><i class="icon-edit"></i>用户列表</div>
                  </div>
                  <div class="portlet-body">
                     <div class="table-toolbar">
                        <div class="btn-group">
                           <button id="sample_editable_1_new" class="btn green">添加 <i class="icon-plus"></i></button>
                        </div>
                     </div>
                     <table class="table table-striped table-hover table-bordered" id="user_table">
                        <thead>
                           <tr>
                              <th>账号</th>
                              <th>密码</th>
                              <th>手机</th>
                              <th>类型</th>
                              <th>操作</th>
                           </tr>
                        </thead>
                        <tbody>
                        {% for item in entities %}
                            <tr >
                              <td>{{ item.user_account }}</td>
                              <td>{{ item.user_password }}</td>
                              <td>{{ item.user_mobile }}</td>
                              {% if item.user_type==1 %}
                                 <td class="center">房东</td>
                              {% elif item.user_type==0 %}
                                  <td class="center">游客</td>
                              {% endif %}
                              <td>
                                  <a class="edit" onclick="showUpdateModal({{ item }});">Edit</a>
                                  <a class="btn default" data-target="#delete-modal" onclick="showDelModal({{ item.user_id }});">DELETE</a>
                              </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                     </table>
                    <nav class="text-center">
                        {% if pagination %}
                        {{ pagination.links }}
                        {% endif %}
                    </nav>
                  </div>
               </div>
            </div>
         </div>
        <div id="update-modal" class="modal fade" tabindex="-1" data-focus-on="input:first">
                       <div class="modal-header">
                         <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                         <h4 class="modal-title">修改用户</h4>
                       </div>
                       <div class="modal-body">
                           <div class="form-group">
                           <input class="form-control" type="text" data-tabindex="1" placeholder="账号" id="user_account">
                         </div>
                         <div class="form-group">
                           <input class="form-control" type="text" data-tabindex="1" placeholder="密码" id="user_password">
                         </div>
                         <div class="form-group">
                           <input class="form-control" type="text" data-tabindex="2" placeholder="手机号" id="user_mobile">
                         </div>
                         <div class="form-group">
                           <input class="form-control" type="text" data-tabindex="2" placeholder="用户类型" id="user_type">
                         </div>
                       </div>
                       <div class="modal-footer">
                         <button type="button" data-dismiss="modal" class="btn btn-default">关闭</button>
                         <button type="button" class="btn btn-primary" onclick="updateUserById()">提交修改</button>
                       </div>
        </div>
        <div id="delete-modal" class="modal fade" tabindex="-1" data-backdrop="static" data-keyboard="false">
                       <div class="modal-body">
                         <p>您确定要删除该用户吗?</p>
                       </div>
                       <div class="modal-footer">
                         <button type="button" data-dismiss="modal" class="btn btn-default">取消</button>
                         <button type="button" data-dismiss="modal" class="btn blue" onclick="delUserById()">继续删除</button>
                       </div>
        </div>
        <input type="hidden" id="hid-user-id" value="">
{% endblock %}
{% block jsblock %}
    <script>
    function showDelModal(id) {
        $("#hid-user-id").val(id);
        $('#delete-modal').modal('show');
    }
    function delUserById() {
        var user_id = $("#hid-user-id").val();
        //ajax api
        var current_url = window.location.href;
        //alert(current_url);
    }
    function showUpdateModal(itemObj) {
        $("#hid-user-id").val(itemObj.user_id);
        $("#user_account").val(itemObj.user_account);
        $("#user_password").val(itemObj.user_password);
        $("#user_mobile").val(itemObj.user_mobile);
        $("#user_type").val(itemObj.user_type);
        $('#update-modal').modal('show');
    }
    function updateUserById() {

        $.ajax({
                url: "/user/do_update_userById",
                type: 'POST',
                data: JSON.stringify({
                    "user_id":$("#hid-user-id").val(),
                    "user_account": $("#user_account").val(),
                    "user_password": $("#user_password").val(),
                    "user_mobile": $("#user_mobile").val(),
                    "user_type":$("#user_type").val()
                }),
                contentType: "application/json",
                success:function (data) {
                    if(data.code == 0){
                        alert("修改失败");
                        return false;
                    }else if(data.code == 1){
                        $('#update-modal').modal('hide');
                        //location.href=window.location.href;
                        location.reload();
                    }
                }
            });
    }
    $(function () {
        
    });
    </script>
{% endblock %}
